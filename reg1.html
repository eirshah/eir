<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shaheir - Children Register</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/tabulator-tables@5.4.4/dist/css/tabulator.min.css" rel="stylesheet">
  <script src="https://unpkg.com/tabulator-tables@5.4.4/dist/js/tabulator.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">
  <header class="bg-gray-100 p-4 shadow mb-4">
    <h1 class="text-2xl font-bold">Shaheir - Children Register</h1>
  </header>

  <main class="p-6 flex-1">
    <div id="registerTable"></div>
  </main>

  <footer class="bg-gray-100 p-4 text-center">
    &copy; Shaheir Registry
  </footer>

  <script>
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyUXD02Ww4DPTiJiO0yKP_DYMeL7b5CueIHaFE9KDZwhcBmm8L2Qt8ZLWtunuxxZFCm/exec?action=getData";

    async function fetchData() {
      try {
        const res = await fetch(WEBAPP_URL);
        if (!res.ok) throw new Error("Network response was not ok");
        const data = await res.json();

        if (!data || data.length === 0) {
          document.getElementById("registerTable").innerHTML =
            "<p class='text-gray-500'>No data found.</p>";
          return;
        }

        // Dynamically create columns based on JSON keys
        const columns = Object.keys(data[0]).map(key => ({
          title: key.replace(/_/g, " ").replace(/\b\w/g, l => l.toUpperCase()),
          field: key,
          headerFilter: "input"
        }));

        new Tabulator("#registerTable", {
          data: data,
          columns: columns,
          layout: "fitDataStretch",
          pagination: "local",
          paginationSize: 10,
          movableColumns: true,
          resizableRows: true,
          tooltips: true,
          height: "600px",
          responsiveLayout: "collapse"
        });

      } catch (err) {
        console.error("Error fetching data:", err);
        document.getElementById("registerTable").innerHTML =
          "<p class='text-red-500'>Error fetching data. Make sure the Web App is deployed and CORS is enabled.</p>";
      }
    }

    fetchData();
  </script>
</body>
</html>
