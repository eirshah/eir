<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shaheir - Children Register</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Optional: Tabulator CDN for table features -->
  <link href="https://unpkg.com/tabulator-tables@5.4.4/dist/css/tabulator.min.css" rel="stylesheet">
  <script src="https://unpkg.com/tabulator-tables@5.4.4/dist/js/tabulator.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- Header will load dynamically -->
  <div id="headerContainer"></div>

  <main class="p-6">
    <h2 class="text-2xl font-bold mb-4">Children Register</h2>
    <div id="registerTable"></div>
  </main>

  <script>
    // Load header dynamically
    fetch("partials/header.html")
      .then(res => res.text())
      .then(html => document.getElementById("headerContainer").innerHTML = html);

    // Replace with your Google Apps Script Web App URL
    const WEBAPP_URL = "YOUR_WEBAPP_URL?action=getRegisterData";

    // Fetch data from Google Sheets
    async function fetchData() {
      try {
        const response = await fetch(WEBAPP_URL);
        const data = await response.json();
        buildTable(data);
      } catch (err) {
        console.error(err);
        document.getElementById("registerTable").innerHTML =
          "<p class='text-red-500'>Error fetching data.</p>";
      }
    }

    function buildTable(data) {
      if (!data || data.length === 0) {
        document.getElementById("registerTable").innerHTML =
          "<p class='text-gray-500'>No data found.</p>";
        return;
      }

      // Define only the first 19 fields
      const columns = [
        { title: "Currently Living", field: "currently_living" },
        { title: "Unique ID", field: "unique_id" },
        { title: "Foolhumaa Form No.", field: "foolhumaa_form_number" },
        { title: "Beneficiary ID", field: "beneficiary_national_id" },
        { title: "Name", field: "beneficiary_name" },
        { title: "DOB", field: "dob" },
        { title: "Time of Birth", field: "time_of_birth" },
        { title: "Age", field: "age" },
        { title: "Sex", field: "sex" },
        { title: "Atoll Residence", field: "atoll_residence" },
        { title: "Island Residence", field: "island_residence" },
        { title: "Current Address", field: "current_address" },
        { title: "Mother Name", field: "mother_name" },
        { title: "Mother ID", field: "mother_national_id" },
        { title: "Primary Contact", field: "primary_contact" },
        { title: "Viber Number", field: "viber_number" },
        { title: "Caregiver Name", field: "caregiver_name" },
        { title: "Caregiver ID", field: "caregiver_id" },
        { title: "Caregiver Contact", field: "caregiver_contact" }
      ];

      // Initialize Tabulator
      new Tabulator("#registerTable", {
        data: data,
        columns: columns,
        layout: "fitDataStretch",
        pagination: "local",
        paginationSize: 10,
        movableColumns: true,
        resizableRows: true,
        tooltips: true,
        addRowPos: "top",
        height: "600px",
        responsiveLayout: "collapse",
      });
    }

    fetchData();
  </script>
</body>
</html>
